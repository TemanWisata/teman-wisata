{{#extend "main-layout"}}
{{#content "navbar"}}
{{> login-navbar }}
{{/content}}
{{#content "content"}}
<div class="container mx-auto p-8">
    <h1 class="text-3xl font-bold mb-6">Cari Tempat Wisata</h1>
    <!-- <form id="filter-form" class="mb-8 flex flex-wrap gap-4">
        <select name="category" class="select select-bordered" id="category">
            <option value="">Kategori</option>
            <option value="Budaya">Budaya</option>
            <option value="Taman Hiburan">Taman Hiburan</option>
        </select>
        <input type="text" name="province" class="input input-bordered" placeholder="Provinsi" id="province" />
        <input type="number" name="min_price" class="input input-bordered" placeholder="Harga Min" id="min_price" />
        <input type="number" name="max_price" class="input input-bordered" placeholder="Harga Max" id="max_price" />
        <input type="number" step="0.1" name="min_rating" class="input input-bordered" placeholder="Rating Min"
            id="min_rating" />
        <input type="number" step="0.1" name="max_rating" class="input input-bordered" placeholder="Rating Max"
            id="max_rating" />
        <button type="submit" class="btn btn-primary">Filter</button>
    </form> -->
    <div id="places-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">

        {{#times 4}}
        {{> place-card }}
        {{/times}}

    </div>
    <div class="join grid grid-cols-2 mt-8">
        <button class="join-item btn btn-outline">Previous page</button>
        <button class="join-item btn btn-outline">Next</button>
    </div>
</div>
<script type="module">
    let page = 1;
    let limit = 9;

    async function fetchPlaces() {
        const form = document.getElementById('filter-form');
        const params = new FormData(form);
        const body = {
            query_filter: {
                category: params.get('category') || null,
                province: params.get('province') || null,
                min_price: params.get('min_price') ? Number(params.get('min_price')) : null,
                max_price: params.get('max_price') ? Number(params.get('max_price')) : null,
                min_rating: params.get('min_rating') ? Number(params.get('min_rating')) : null,
                max_rating: params.get('max_rating') ? Number(params.get('max_rating')) : null,
            },
            page,
            limit,
        };
        const res = await fetch('/api/v1/place/', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(body),
        });
        const { data } = await res.json();
        renderPlaces(data.places);
        updatePagination(data.pagination);
    }

    function renderPlaces(places) {
        const container = document.getElementById('places-list');
        container.innerHTML = '';
        if (!places || places.length === 0) {
            container.innerHTML = '<div class="text-center text-gray-500">Tidak ada tempat ditemukan.</div>';
            return;
        }
        for (const place of places) {
            container.innerHTML += `
            <div class="card bg-base-100 shadow-sm">
              <div class="card-body">
                <h2 class="card-title">${place.place_name}</h2>
                <div class="badge badge-outline">${place.category}</div>
                <div class="badge badge-outline">${place.province}</div>
                <p>${place.description || ''}</p>
                <div class="card-actions justify-end">
                  <a class="btn btn-primary" href="/place.html?id=${place.id}">Lebih lanjut</a>
                </div>
              </div>
            </div>
          `;
        }
    }

    function updatePagination(pagination) {
        document.getElementById('page-info').textContent = `Halaman ${pagination.page}`;
        document.getElementById('prev-page').disabled = !pagination.has_prev;
        document.getElementById('next-page').disabled = !pagination.has_next;
    }

    document.getElementById('filter-form').addEventListener('submit', e => {
        e.preventDefault();
        page = 1;
        fetchPlaces();
    });

    document.getElementById('prev-page').addEventListener('click', () => {
        if (page > 1) {
            page--;
            fetchPlaces();
        }
    });

    document.getElementById('next-page').addEventListener('click', () => {
        page++;
        fetchPlaces();
    });

    // Initial load
    fetchPlaces();
</script>
{{/content}}
{{/extend}}
